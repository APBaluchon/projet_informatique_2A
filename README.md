<img src="business_layer/service/graphs/assets/logo.png" alt="GameGenius_logo" width="100" height="100">

# GameGenius: League of Legends Performance Metrics

## Description

GameGenius is a tool for League of Legends (LoL) players. This application provides insightful metrics, allowing players to compare their in-game performance in a specific role with other players in the same division. It utilizes data visualization to present these metrics in an interactive and user-friendly manner.

## Features
- **Performance Comparison:** Enables LoL players to compare their stats with others in the same division.
- **Role-Specific Metrics:** Focus on performance metrics specific to the player's role.
- **Interactive Data Visualization:** Uses Plotly and Dash for dynamic and interactive graphical representations.
- **User-Friendly Interface:** Command-line and web interfaces for ease of use and accessibility.
- **Database Integration:** Efficiently stores and retrieves player data using a PostgreSQL database.

## Getting Started

### Dependencies
- Python 3.x
- **Libraries:** requests, psycopg2-binary, dataclasses, python-dotenv, fastapi, inquirerPy, plotly, dash, dash-bootstrap-components, dash-bootstrap-templates, pylint, autopep8
- PostgreSQL Database

### Installing
- Clone the repo : `git clone https://github.com/APBaluchon/projet_informatique_2A.git`
- Install required packages : `pip install -r requirements.txt` 

### Setting Up

- Create a `.env` file in the project root with following variables.
```python
HOST_WEBSERVICE=
HOST=
PORT=
DATABASE=
USER=
PASSWORD=
```
- To set up the database, run the SQL scripts located in the persistance_layer directory. This will create and populate the database with the necessary tables and data. You must  run the creation scripts before the fill scripts.

### Executing the Program

- Run the main application file (e.g., python main.py).
- Access the web application via a browser to view and interact with the performance metrics. `http://127.0.0.1:8050/` by default.

## Output Example

Below is an example of the output generated by GameGenius.

![Output Example](images/SortieGraphique.png)

## License
This project is licensed under the [GNU General Public License v3.0](https://www.gnu.org/licenses/gpl-3.0.html).

## Acknowledgments

- The League of Legends community for inspiration.
- Open source projects and libraries that contributed to this project.

## Class Overview: DBHandler

### Purpose
The DBHandler class is designed to handle interactions with the users database. It centralizes methods for common tasks like checking user existence and creating new users.

### Methods

####  `is_user_in_db(self, pseudo)`
- **Purpose**: Determines if a user exists in the database.
- **Parameters**: `pseudo` (str) - Username of the user to check.
- **Returns**: `bool` - True if user exists, False otherwise.

####  `create_user(self, pseudo, password)`
- **Purpose**: Safely creates a new user with a hashed password, enhancing the application's security.
- **Parameters**: 
  - `pseudo` (str) - Username for the new user.
  - `password` (str) - User's password to be hashed and stored.
- **Returns**: `bool` - True if creation is successful, False otherwise.
- **Strengths**: Utilizes password hashing for security and prevents user duplication.

####  `is_password_correct(self, pseudo, password)`
- **Purpose**: Verifies if the provided password matches the stored hashed password, a key component for secure login.
- **Parameters**: 
  - `pseudo` (str) - Username of the user.
  - `password` (str) - Password to verify.
- **Returns**: `bool` - True if the password is correct, False otherwise.

####  `get_user_role(self, pseudo)`
- **Purpose**: Retrieves the role of a user, useful for role-based access control in the application.
- **Parameters**: `pseudo` (str) - Username of the user.
- **Returns**: `str` - Role of the user, or None if not found.

####  `display_database(self)`
- **Purpose**: Displays a list of all users and their roles, beneficial for administrative purposes.

####  `update_database(self)`
- **Purpose**: General method to update user information, such as password or role, based on user input.

####  `update_password(self, pseudo_compte)`
- **Purpose**: Specifically updates a user's password, an essential feature for account security.
- **Parameters**: `pseudo_compte` (str) - Username of the user.

####  `update_role(self, pseudo_compte)`
- **Purpose**: Changes the role of a user, allowing dynamic role management.
- **Parameters**: `pseudo_compte` (str) - Username of the user.

####  `delete_account_from_database(self)`
- **Purpose**: Facilitates the deletion of a user account, a necessary feature for user data management.

####  `create_new_account(self, pseudo)`
- **Purpose**: High-level method to create a new user account.
- **Parameters**: `pseudo` (str) - Username for the new account.
- **Returns**: `Bool` - True if account creation is successful, False otherwise.

### Key Features
- **Security**: Employs password hashing for data protection.
- **Modularity**: Offers a range of methods for different aspects of user management.
- **Flexibility**: Adaptable methods for diverse database operations.

### Pylint Score
This class has been rated at **9.15/10** with PyLint. Remaining problems are `Catching too general exception Exception`.

### Python Code

```python
"""
This module provides a class for handling interactions with the database.

This class provides methods to perform various database operations
such as checking if a user exists, creating a new user, etc.
"""
import hashlib
from business_layer.dao.dbconnection import DBConnection
from business_layer.service.singleton.singleton import Singleton
from business_layer.controler.dbview import DBView


class DBHandler(metaclass=Singleton):
    """
    A class that handles interactions with the database.

    This class provides methods to perform various database operations
    such as checking if a user exists, creating a new user, etc.
    """
    def is_user_in_db(self, pseudo):
        """
        Checks if a user exists in the database.

        Parameters
        ----------
        pseudo : str
            The pseudo of the user to check.

        Returns
        -------
        bool
            True if the user exists in the database, False otherwise.
        """
        try:
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "SELECT * FROM projet_info.utilisateur u "
                        "WHERE u.pseudo = %s",
                        (pseudo,))
                    res = cursor.fetchone()
                    return bool(res)
        except Exception as e:
            print(f"Error checking user in DB: {e}")
            return False

    def create_user(self, pseudo, password):
        """
        Creates a new user in the database with hashed password.

        Parameters
        ----------
        pseudo : str
            The pseudo of the user to create.
        password : str
            The password of the user to create.

        Returns
        -------
        bool
            True if the user creation is successful, False otherwise.
        """
        if not pseudo or not password:
            print("Invalid pseudo or password.")
            return False

        hashed_password = hashlib.sha256(password.encode()).hexdigest()

        try:
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    query = (
                        "INSERT INTO projet_info.utilisateur "
                        "VALUES (%s, %s, 'user')"
                    )
                    cursor.execute(query, (pseudo, hashed_password))
                    connection.commit()
                    return True
        except Exception as e:
            print(f"Error creating user in DB: {e}")
            return False

    def is_password_correct(self, pseudo, password):
        """
        Checks if the provided password matches the hashed password
        in the database.

        Parameters
        ----------
        pseudo : str
            The pseudo of the user whose password is being verified.
        password : str
            The password to be verified.

        Returns
        -------
        bool
            True if the password matches the one in the database,
            False otherwise.
        """
        try:
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "SELECT mdp FROM projet_info.utilisateur "
                        "WHERE pseudo = %s",
                        (pseudo,)
                    )
                    res = cursor.fetchone()
                    if res:
                        stored_password = res['mdp']
                        hashed_input_password = hashlib.sha256(
                            password.encode()
                            ).hexdigest()
                        return hashed_input_password == stored_password
                    return False
        except Exception as e:
            print(f"Error verifying password in DB: {e}")
            return False

    def get_user_role(self, pseudo):
        """
        Retrieves the role of a user from the database.

        Parameters
        ----------
        pseudo : str
            The pseudo of the user whose role is being retrieved.

        Returns
        -------
        str
            The role of the user in the database.
            Returns None if the user is not found.
        """
        try:
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "SELECT role FROM projet_info.utilisateur "
                        "WHERE pseudo = %s", (pseudo,))
                    res = cursor.fetchone()
                    return res['role'] if res else None
        except Exception as e:
            print(f"Error retrieving user role from DB: {e}")
            return None

    def display_database(self):
        """
        Displays the list of users in the database.
        """
        try:
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "SELECT pseudo, role FROM projet_info.utilisateur"
                    )
                    users = cursor.fetchall()

            print("User List:")
            for user in users:
                print(f"{user['pseudo']} - {user['role']}")

            DBView().press_enter()
        except Exception as e:
            print(f"Error displaying database: {e}")

    def update_database(self):
        """
        Updates the information of a user in the database.

        This method first prompts for the user's pseudo, and if the pseudo
        exists in the database,
        it then asks which aspect of the user's information should be
        updated (e.g., password, role).
        Based on the choice, it delegates to the appropriate method for
        updating the specific information.
        """
        try:
            pseudo_compte = DBView().ask_pseudo()

            while not self.is_user_in_db(pseudo_compte):
                print("Pseudo isn't in database.")
                pseudo_compte = DBView().ask_pseudo()

            info_to_update = DBView().ask_modality()

            if info_to_update == "Password":
                return self.update_password(pseudo_compte)
            if info_to_update == "Rôle":
                return self.update_role(pseudo_compte)
        except Exception as e:
            print(f"Error updating database: {e}")
            return None

    def update_password(self, pseudo_compte):
        """
        Updates the password for a given user in the database.

        Parameters
        ----------
        pseudo_compte : str
            The pseudo of the user whose password is being updated.
        """
        try:
            new_password = DBView().ask_new_password()
            hashed_password = hashlib.sha256(new_password.encode()).hexdigest()
            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "UPDATE projet_info.utilisateur "
                        "SET mdp = %s "
                        "WHERE pseudo = %s", (hashed_password, pseudo_compte))
                    connection.commit()
        except Exception as e:
            print(f"Error updating password in DB: {e}")

    def update_role(self, pseudo_compte):
        """
        Updates the role of a specific user in the database.

        Parameters
        ----------
        pseudo_compte : str
            The pseudo of the user whose role is being updated.

        """
        try:
            role_actuel = self.get_user_role(pseudo_compte)
            if role_actuel is None:
                print(f"No user found with pseudo: {pseudo_compte}")
                return
            new_role = 'admin' if role_actuel == 'user' else 'user'

            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "UPDATE projet_info.utilisateur "
                        "SET role = %s "
                        "WHERE pseudo = %s", (new_role, pseudo_compte))
                    connection.commit()
        except Exception as e:
            print(f"Error updating role in DB: {e}")

    def delete_account_from_database(self):
        """
        Deletes a user account from the database.
        """
        try:
            pseudo_compte = DBView().ask_pseudo()

            if not self.is_user_in_db(pseudo_compte):
                print("Pseudo isn't in database.")
                return

            with DBConnection().connection as connection:
                with connection.cursor() as cursor:
                    cursor.execute(
                        "DELETE FROM projet_info.utilisateur "
                        "WHERE pseudo = %s", (pseudo_compte,))
                    connection.commit()
                    print("Account deleted with success.")
        except Exception as e:
            print(f"Error deleting account from DB: {e}")

    def create_new_account(self, pseudo):
        """
        Creates a new user account in the database.

        Parameters
        ----------
        pseudo : str
            The pseudo for the new user account.

        Returns
        -------
        Bool
            True is account has beed created, otherwise False.
        """
        try:
            password = DBView().ask_password_new_account()

            if self.is_user_in_db(pseudo):
                print("This user already exists.")
                return False

            if self.create_user(pseudo, password):
                print("Account has been created with success !")
                return True
            print("Account creation has failed.")
            return False

        except Exception as e:
            print(f"Creation failed : {e}")
            return False
```